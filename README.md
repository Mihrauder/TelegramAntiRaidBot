# Антирейд Бот для Telegram v4.0

## Основные возможности

### Защита от рейдов
- Автоматическое обнаружение массовых входов
- Мгновенный бан подозрительных участников
- Гибкая настройка порогов срабатывания
- Автоматическое удаление сообщений о входе

### Дополнительные проверки
- Проверка наличия username
- Проверка фото профиля
- Проверка возраста аккаунта
- Белый список доверенных пользователей

### Администрирование
- Статистика банов
- Гибкие настройки через команды
- Логирование всех событий
- Интерактивное меню настроек

## Установка

### 1. Установите зависимости:
```bash
pip install -r requirements.txt
```

### 2. Настройте бота:
Откройте файл `antiraid_bot.py` и заполните:
```python
@dataclass
class BotConfig:
    TOKEN: str = "YOUR_BOT_TOKEN_HERE"  # Токен от @BotFather
    ADMIN_IDS: List[int] = [123456789, 987654321]  # ID администраторов бота
    
    RAID_THRESHOLD: int = 4  # Сколько входов = рейд (рекомендуется 4)
    TIME_WINDOW: int = 1  # За сколько секунд считать входы
    
    CHECK_USERNAME: bool = True  # Банить без username (@никнейма)
    CHECK_PROFILE_PHOTO: bool = False  # Банить без аватарки
    MIN_ACCOUNT_AGE_DAYS: int = 0  # Мин. возраст аккаунта в днях (0 = выкл)
    
    AUTO_DELETE_JOIN_MESSAGES: bool = True  # Удалять сообщения "присоединился"
    BAN_DURATION: int = 0  # Длительность бана в секундах (0 = навсегда)
```

### 3. Получите токен бота:
1. Напишите @BotFather
2. Отправьте /newbot
3. Следуйте инструкциям
4. Скопируйте полученный токен

### 4. Узнайте свой ID:
1. Напишите @userinfobot
2. Скопируйте ваш ID
3. Добавьте в ADMIN_IDS

### 5. Добавьте бота в чат:
1. Добавьте бота в ваш чат
2. Сделайте его администратором с правами:
   - Удаление сообщений
   - Бан пользователей

## Запуск
```bash
python antiraid_bot.py
```

## Команды

### Для всех пользователей:
- /start - Информация о боте и его настройках

### Только для администраторов:

#### Статистика
```
/stats - Показать статистику банов и активности
```

#### Настройки
```
/settings - Открыть меню настроек
```
Интерактивное меню с кнопками для быстрого изменения параметров

#### Очистка
```
/clear - Очистить историю входов
```
Полезно после окончания рейда или для сброса счетчиков

#### Белый список
```
/whitelist - Показать справку
/whitelist toggle - Включить/выключить белый список
/whitelist add [ID] - Добавить пользователя
/whitelist remove [ID] - Удалить пользователя
/whitelist list - Показать всех в списке
```

Примеры:
```
/whitelist add 123456789
/whitelist remove 987654321
/whitelist toggle
```

## Конфигурация

### Основные параметры

#### RAID_THRESHOLD
Количество входов, после которого срабатывает защита:
- 3 - строгий режим
- 4 - рекомендуемый
- 5+ - мягкий режим

#### TIME_WINDOW
Временное окно в секундах:
- 1 - очень быстрые рейды
- 2-3 - обычные рейды
- 5+ - медленные атаки

#### CHECK_USERNAME
Банить пользователей без username:
- True - повышенная защита (может быть жестко)
- False - только рейды

#### CHECK_PROFILE_PHOTO
Банить пользователей без фото профиля:
- True - максимальная защита
- False - рекомендуется (много ложных срабатываний)

#### AUTO_DELETE_JOIN_MESSAGES
Удалять сообщения о входе/выходе:
- True - чистый чат
- False - сохранять уведомления

#### BAN_DURATION
Длительность бана:
- 0 - перманентный бан
- 3600 - 1 час
- 86400 - 1 день
- 604800 - 1 неделя

### Примеры конфигураций

#### Строгая защита (для проблемных чатов):
```python
RAID_THRESHOLD: int = 3
TIME_WINDOW: int = 2
CHECK_USERNAME: bool = True
CHECK_PROFILE_PHOTO: bool = True
```

#### Сбалансированная (рекомендуется):
```python
RAID_THRESHOLD: int = 4
TIME_WINDOW: int = 1
CHECK_USERNAME: bool = True
CHECK_PROFILE_PHOTO: bool = False
```

#### Мягкая (для спокойных чатов):
```python
RAID_THRESHOLD: int = 5
TIME_WINDOW: int = 3
CHECK_USERNAME: bool = False
CHECK_PROFILE_PHOTO: bool = False
```

## Логирование

Бот создает два типа логов:

### Консольные логи:
Выводятся в терминал в реальном времени:
```
2025-01-28 12:34:56 | INFO     | Новые участники в чате TestChat
2025-01-28 12:34:56 | WARNING  | РЕЙД ОБНАРУЖЕН! 5 входов за 1с
2025-01-28 12:34:56 | WARNING  | Забанен: @username
```

### Файловые логи:
Сохраняются в antiraid_bot.log:
- История всех событий
- Ошибки и предупреждения
- Действия администраторов

## Устранение неполадок

### Бот не банит пользователей:
1. Убедитесь, что бот является администратором
2. Проверьте права бота (бан + удаление сообщений)
3. Проверьте, что TOKEN указан правильно

### Слишком много ложных срабатываний:
1. Увеличьте RAID_THRESHOLD (например, до 5-6)
2. Отключите CHECK_USERNAME и CHECK_PROFILE_PHOTO
3. Добавьте проверенных пользователей в белый список

### Рейды все равно проходят:
1. Уменьшите RAID_THRESHOLD (до 3)
2. Уменьшите TIME_WINDOW (до 1)
3. Включите дополнительные проверки

### Бот не отвечает на команды:
1. Проверьте, что ваш ID в ADMIN_IDS
2. Используйте команды в чате, где бот админ
3. Проверьте логи на наличие ошибок

## Что нового в v4.0

### Новые возможности:
- Система белого списка
- Интерактивные настройки через кнопки
- Расширенная статистика
- Файловое логирование
- Проверка возраста аккаунта
- Настраиваемая длительность бана

### Улучшения:
- Оптимизированный код
- Лучшая архитектура (классы и dataclass)
- Более информативные логи
- Автоочистка старых записей

### Исправления:
- Исправлена утечка памяти
- Улучшена обработка ошибок
- Исправлены редкие краши

## Рекомендации

### Для малых чатов (<100 человек):
```python
RAID_THRESHOLD: int = 4
TIME_WINDOW: int = 2
CHECK_USERNAME: bool = False
```

### Для средних чатов (100-1000 человек):
```python
RAID_THRESHOLD: int = 4
TIME_WINDOW: int = 1
CHECK_USERNAME: bool = True
```

### Для больших чатов (1000+ человек):
```python
RAID_THRESHOLD: int = 3
TIME_WINDOW: int = 1
CHECK_USERNAME: bool = True
CHECK_PROFILE_PHOTO: bool = True
WHITELIST_ENABLED: bool = True
```

## Поддержка

При обнаружении багов:
1. Проверьте логи в файле antiraid_bot.log
2. Убедитесь, что используете последнюю версию
3. Проверьте настройки конфигурации

## Важно

- Бот НЕ сохраняет данные между перезапусками
- Для постоянной работы используйте screen/tmux или systemd
- Регулярно проверяйте логи на наличие ошибок
- Не давайте боту больше прав, чем необходимо

Версия: 4.0
Дата обновления: 28.01.2025
